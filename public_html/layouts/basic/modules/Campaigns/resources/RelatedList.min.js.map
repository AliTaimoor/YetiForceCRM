{"version":3,"file":"RelatedList.min.js","sources":["RelatedList.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_RelatedList_Js(\n\t'Campaigns_RelatedList_Js',\n\t{},\n\t{\n\t\tgetCompleteParams: function () {\n\t\t\tvar params = this._super();\n\t\t\tvar container = this.getRelatedContainer();\n\t\t\tparams['selectedIds'] = container.find('#selectedIds').data('selectedIds');\n\t\t\tparams['excludedIds'] = container.find('#excludedIds').data('excludedIds');\n\t\t\treturn params;\n\t\t},\n\t\tchangeCustomFilterElementView: function () {\n\t\t\tvar filterSelectElement = this.content.find('#customFilter');\n\t\t\tif (filterSelectElement.length > 0) {\n\t\t\t\tApp.Fields.Picklist.showSelect2ElementView(filterSelectElement, {\n\t\t\t\t\ttemplateSelection: function (data) {\n\t\t\t\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\t\t\t\tresultContainer.append(jQuery(jQuery('.filterImage').detach().get(0)).show());\n\t\t\t\t\t\tresultContainer.append(data.text);\n\t\t\t\t\t\treturn resultContainer;\n\t\t\t\t\t},\n\t\t\t\t\tcustomSortOptGroup: true,\n\t\t\t\t\tcloseOnSelect: true\n\t\t\t\t});\n\t\t\t\tvar select2Instance = filterSelectElement.data('select2');\n\t\t\t\tselect2Instance.$dropdown.append(this.content.find('span.filterActionsDiv'));\n\t\t\t}\n\t\t},\n\t\tregisterChangeCustomFilterEvent: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\t\tvar filterSelectElement = relatedContainer.find('.loadFormFilterButton');\n\t\t\tvar customFilter = relatedContainer.find('#customFilter');\n\t\t\tfilterSelectElement.on('click', function (e) {\n\t\t\t\tvar message = app.vtranslate('JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_ADD_THIS_FILTER');\n\t\t\t\tVtiger_Helper_Js.showConfirmationBox({ message: message }).done(function () {\n\t\t\t\t\tvar cvId = customFilter.val();\n\t\t\t\t\tvar relatedModuleName = relatedContainer.find('.relatedModuleName').val();\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\tsourceRecord: app.getRecordId(),\n\t\t\t\t\t\trelatedModule: relatedModuleName,\n\t\t\t\t\t\tviewId: cvId,\n\t\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\t\tmode: 'addRelationsFromRelatedModuleViewId'\n\t\t\t\t\t};\n\t\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\t\tposition: 'html',\n\t\t\t\t\t\tblockInfo: {\n\t\t\t\t\t\t\tenabled: true\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t\t.done(function (responseData) {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tif (responseData.result === false) {\n\t\t\t\t\t\t\t\tvar message = app.vtranslate('JS_NO_RECORDS_RELATED_TO_THIS_FILTER');\n\t\t\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\t\t\ttext: message,\n\t\t\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tVtiger_Detail_Js.reloadRelatedList();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fail(function () {\n\t\t\t\t\t\t\tprogressIndicatorElement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Function to edit related status for email enabled modules of campaigns\n\t\t */\n\t\tregisterEventToEditRelatedStatus: function () {\n\t\t\tvar thisInstance = this;\n\t\t\tvar relatedContainer = thisInstance.getRelatedContainer();\n\t\t\trelatedContainer.find('.currentStatus').on('click', function (e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\telement.addClass('open');\n\t\t\t});\n\t\t\tvar statusDropdown = relatedContainer.find('.currentStatus').find('.dropdown-menu');\n\t\t\tstatusDropdown.on('click', 'a', function (e) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\t\tvar liContainer = element.closest('li');\n\t\t\t\tvar currentStatus = element.closest('.currentStatus');\n\t\t\t\tvar selectedStatusId = liContainer.attr('id');\n\t\t\t\tvar selectedStatusValue = liContainer.data('status');\n\t\t\t\tvar relatedRecordId = element.closest('tr').data('id');\n\t\t\t\tvar params = {\n\t\t\t\t\trelatedModule: thisInstance.relatedModulename,\n\t\t\t\t\trelatedRecord: relatedRecordId,\n\t\t\t\t\tstatus: selectedStatusId,\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\taction: 'RelationAjax',\n\t\t\t\t\tsourceRecord: thisInstance.parentRecordId,\n\t\t\t\t\tmode: 'updateStatus'\n\t\t\t\t};\n\t\t\t\telement.progressIndicator();\n\t\t\t\tAppConnector.request(params)\n\t\t\t\t\t.done(function (responseData) {\n\t\t\t\t\t\tif (responseData.result[0]) {\n\t\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t\t\tcurrentStatus.find('.statusValue').text(selectedStatusValue);\n\t\t\t\t\t\t\tcurrentStatus.removeClass('open');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fail(function () {\n\t\t\t\t\t\telement.progressIndicator({ mode: 'hide' });\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tregisterPostLoadEvents: function () {\n\t\t\tthis._super();\n\t\t\tthis.changeCustomFilterElementView();\n\t\t\tthis.registerChangeCustomFilterEvent();\n\t\t\tthis.registerEventToEditRelatedStatus();\n\t\t}\n\t}\n);\n"],"names":["Vtiger_RelatedList_Js","getCompleteParams","params","_super","container","getRelatedContainer","find","data","changeCustomFilterElementView","filterSelectElement","content","length","App","Fields","Picklist","showSelect2ElementView","templateSelection","resultContainer","jQuery","append","detach","get","show","text","customSortOptGroup","closeOnSelect","select2Instance","$dropdown","registerChangeCustomFilterEvent","thisInstance","relatedContainer","customFilter","on","message","app","vtranslate","Vtiger_Helper_Js","showConfirmationBox","done","cvId","val","relatedModuleName","sourceRecord","getRecordId","relatedModule","viewId","module","getModuleName","action","mode","progressIndicatorElement","progressIndicator","position","blockInfo","enabled","AppConnector","request","responseData","result","showMessage","type","Vtiger_Detail_Js","reloadRelatedList","fail","registerEventToEditRelatedStatus","e","stopImmediatePropagation","element","currentTarget","addClass","statusDropdown","liContainer","closest","currentStatus","selectedStatusId","attr","selectedStatusValue","relatedRecordId","relatedModulename","relatedRecord","status","parentRecordId","removeClass","registerPostLoadEvents"],"mappings":"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"}