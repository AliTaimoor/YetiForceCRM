{"version":3,"file":"CalendarQuickCreate.min.js","sources":["CalendarQuickCreate.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n *  Class representing a modal calendar.\n * @extends Calendar_Calendar_Js\n */\nwindow.Calendar_CalendarQuickCreate_Js = class Calendar_CalendarQuickCreate_Js extends Calendar_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.isSwitchAllDays = false;\n\t\tthis.sidebarName = 'add'; //available: add, status, edit\n\t\tthis.eventCreate = false;\n\t\tthis.module = 'Calendar';\n\t\tthis.renderCalendar();\n\t\tthis.registerEvents();\n\t}\n\t/**\n\t * Function sets calendar module's options\n\t * @returns {{eventClick: function, headerToolbar: object, selectable: boolean}}\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet options = super.setCalendarModuleOptions();\n\t\toptions.selectable = true;\n\t\toptions.headerToolbar = {\n\t\t\tleft: `dayGridMonth,${app.getMainParams('weekView')},${app.getMainParams('dayView')},today`,\n\t\t\tcenter: 'prevYear,prev,title,next,nextYear',\n\t\t\tright: ''\n\t\t};\n\t\toptions.eventClick = function (info) {\n\t\t\tinfo.jsEvent.preventDefault();\n\t\t};\n\t\treturn options;\n\t}\n\t/**\n\t * Get selected users\n\t * @returns {{ selectedIds: array, excludedIds: array }}\n\t */\n\tgetSelectedUsersCalendar() {\n\t\treturn { selectedIds: [this.container.find('.assigned_user_id').val()], excludedIds: [] };\n\t}\n\t/**\n\t * Function registers calendar events\n\t */\n\tregisterEvents() {\n\t\tconst calendarView = this.getCalendarView();\n\t\tthis.switchContainer = $(`<div class=\"js-calendar-switch-container\"></div>`).insertAfter(\n\t\t\tcalendarView.find('.fc-center')\n\t\t);\n\t\tthis.registerSwitchEvents();\n\t\tthis.registerUsersChange();\n\t\tthis.registerAutofillTime();\n\t\tthis.registerPopoverButtonsClickEvent();\n\t}\n\t/**\n\t * Function registers calendar switch event\n\t */\n\tregisterSwitchEvents() {\n\t\tif (app.getMainParams('hiddenDays', true) !== false) {\n\t\t\tthis.switchContainer.html(this.createSwitch());\n\t\t\tthis.switchContainer.find('input').on('change', (e) => {\n\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\tlet hiddenDays = [];\n\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t\tthis.isSwitchAllDays = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.isSwitchAllDays = true;\n\t\t\t\t}\n\t\t\t\tthis.fullCalendar.setOption('hiddenDays', hiddenDays);\n\t\t\t\tthis.registerSwitchEvents();\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Generate filter buttons\n\t * @returns {string}\n\t */\n\tcreateSwitch() {\n\t\tlet on = app.vtranslate('JS_WORK_DAYS'),\n\t\t\toff = app.vtranslate('JS_ALL'),\n\t\t\tstate = this.isSwitchAllDays;\n\t\treturn `<div class=\"btn-group btn-group-toggle js-switch c-calendar-switch\" data-toggle=\"buttons\">\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button js-switch--label-on ${state ? '' : 'active'}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-on-text=\"${on}\" autocomplete=\"off\" ${state ? '' : 'checked'}>${on}\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button ${state ? 'active' : ''}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-off-text=\"${off}\" autocomplete=\"off\" ${state ? 'checked' : ''}>${off}\n\t\t\t\t\t</label>\n\t\t\t\t</div>`;\n\t}\n\t/**\n\t * Function registers select's user change event\n\t */\n\tregisterUsersChange() {\n\t\tthis.container.find('.assigned_user_id').on('change', () => {\n\t\t\tthis.reloadCalendarData();\n\t\t});\n\t}\n\t/**\n\t * Function invokes by FullCalendar, sets selected days in form\n\t * @param {Object} info\n\t * @returns\n\t */\n\tselectDays(info) {\n\t\tif (this.sidebarName === 'status') {\n\t\t\tthis.sidebarName = 'add';\n\t\t\tthis.getCalendarCreateView().done(() => {\n\t\t\t\tthis.selectDays(info);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tthis.selectCallbackCreateModal(this.container, info);\n\t}\n\n\t/** @inheritdoc */\n\tregisterEditForm(sideBar) {\n\t\tlet editViewInstance = Vtiger_Edit_Js.getInstanceByModuleName(sideBar.find('[name=\"module\"]').val()),\n\t\t\tparams = [];\n\t\tlet rightFormCreate = sideBar.find('form.js-form');\n\t\teditViewInstance.registerBasicEvents(rightFormCreate);\n\t\trightFormCreate.validationEngine(app.validationEngineOptions);\n\t\tApp.Fields.Picklist.showSelect2ElementView(sideBar.find('select'));\n\t\tsideBar.find('.js-summary-close-edit').on('click', () => {\n\t\t\tthis.getCalendarCreateView();\n\t\t});\n\t\tApp.Components.QuickCreate.registerPostLoadEvents(rightFormCreate, params);\n\t\tApp.Fields.Text.Editor.register(sideBar.find('.js-editor'), { height: '5em', toolbar: 'Min' });\n\t}\n\n\t/** @inheritdoc */\n\tupdateSidebar(sidebar, data) {\n\t\tconst modalTitleContainer = $('.js-modal-title__container'),\n\t\t\tmodalTitles = modalTitleContainer.find('[class*=\"js-modal-title\"]');\n\t\tdata = $(data);\n\n\t\tmodalTitles.addClass('d-none');\n\t\tif (data.hasClass('js-edit-form')) {\n\t\t\tlet title = data.find('.js-sidebar-title ').data('title');\n\t\t\tmodalTitles.filter(`.js-modal-title--${title}`).removeClass('d-none');\n\t\t\tthis.sidebarName = title;\n\t\t} else if (data.hasClass('js-activity-state')) {\n\t\t\tmodalTitles.filter('.js-modal-title--status').removeClass('d-none');\n\t\t\tthis.sidebarName = 'status';\n\t\t}\n\t\tsidebar.find('.js-qc-form').html(data);\n\t}\n};\n\njQuery.Class(\n\t'Calendar_QuickCreate_Js',\n\t{},\n\t{\n\t\tregisterEvents: function (container) {\n\t\t\tnew Calendar_CalendarQuickCreate_Js(container.closest('.js-modal-container'), true);\n\t\t\tcontainer.find('.js-activity-buttons button').on('click', function (e) {\n\t\t\t\tlet form = container.find('form');\n\t\t\t\tlet currentTarget = $(e.currentTarget);\n\t\t\t\tif (1 === currentTarget.data('type')) {\n\t\t\t\t\tform.append('<input type=hidden name=\"activitystatus\" value=\"' + currentTarget.data('state') + '\">');\n\t\t\t\t\tform.submit();\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.find('.js-activity-buttons').remove();\n\t\t\t\t\tform.find('[name=\"record\"]').val('');\n\t\t\t\t\tform.append('<input type=hidden name=\"postponed\" value=\"true\">');\n\t\t\t\t\tform.append('<input type=hidden name=\"followup\" value=\"' + currentTarget.data('id') + '\">');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n);\n"],"names":["window","Calendar_CalendarQuickCreate_Js","container","readonly","isSwitchAllDays","sidebarName","eventCreate","module","renderCalendar","registerEvents","options","selectable","headerToolbar","left","app","getMainParams","center","right","eventClick","info","jsEvent","preventDefault","selectedIds","find","val","excludedIds","calendarView","getCalendarView","switchContainer","$","insertAfter","registerSwitchEvents","registerUsersChange","registerAutofillTime","registerPopoverButtonsClickEvent","html","createSwitch","on","e","currentTarget","hiddenDays","data","fullCalendar","setOption","vtranslate","off","state","reloadCalendarData","getCalendarCreateView","done","selectDays","selectCallbackCreateModal","sideBar","editViewInstance","Vtiger_Edit_Js","getInstanceByModuleName","rightFormCreate","registerBasicEvents","validationEngine","validationEngineOptions","App","Fields","Picklist","showSelect2ElementView","Components","QuickCreate","registerPostLoadEvents","Text","Editor","register","height","toolbar","sidebar","modalTitleContainer","modalTitles","addClass","hasClass","title","filter","removeClass","Calendar_Calendar_Js","jQuery","Class","closest","form","append","submit","remove"],"mappings":"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"}