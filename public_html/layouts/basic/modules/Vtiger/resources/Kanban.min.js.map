{"version":3,"file":"Kanban.min.js","sources":["Kanban.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 4.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\n\t'Vtiger_Kanban_Js',\n\t{},\n\t{\n\t\t/**\n\t\t * Get params\n\t\t */\n\t\tgetParams: function () {\n\t\t\tconst params = [];\n\t\t\tthis.page.find('.js-params').each(function () {\n\t\t\t\tlet element = $(this);\n\t\t\t\tparams[element.attr('name')] = element.val();\n\t\t\t});\n\t\t\treturn $.extend(\n\t\t\t\t{\n\t\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\t\tview: 'Kanban',\n\t\t\t\t\tboard: this.page.find('.js-board-tab.active').data('id')\n\t\t\t\t},\n\t\t\t\tparams\n\t\t\t);\n\t\t},\n\t\tloadKanban: function () {\n\t\t\tconst params = this.getParams(),\n\t\t\t\turlParams = Object.assign({}, params);\n\t\t\tdelete urlParams.orderBy;\n\t\t\tapp.changeUrl(urlParams);\n\t\t\tAppConnector.request(params)\n\t\t\t\t.done((responseData) => {\n\t\t\t\t\tthis.container.html(responseData);\n\t\t\t\t\tthis.registerSortable();\n\t\t\t\t})\n\t\t\t\t.fail((status, errorThrown) => {\n\t\t\t\t\tapp.showNotify({\n\t\t\t\t\t\ttitle: app.vtranslate('JS_ERROR'),\n\t\t\t\t\t\ttext: errorThrown,\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t},\n\t\tregisterSortable: function () {\n\t\t\tconst boards = this.container.find('.js-kanban-records');\n\t\t\tboards.sortable({\n\t\t\t\tcontainment: this.container,\n\t\t\t\titems: boards.find('.js-kanban-record'),\n\t\t\t\tcancel: '.js-kanban-disabled',\n\t\t\t\tconnectWith: boards,\n\t\t\t\tplaceholder: 'c-kanban__highlight',\n\t\t\t\trevert: true,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tupdate: (e, ui) => {\n\t\t\t\t\tif (ui.sender == null) {\n\t\t\t\t\t\tconst records = ui.item.closest('.js-kanban-records');\n\t\t\t\t\t\tVtiger_Edit_Js.saveAjax({\n\t\t\t\t\t\t\trecord: ui.item.data('id'),\n\t\t\t\t\t\t\tfield: records.data('field'),\n\t\t\t\t\t\t\tvalue: records.data('value')\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.done(() => {\n\t\t\t\t\t\t\t\tthis.loadKanban();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.fail(function (error, err) {\n\t\t\t\t\t\t\t\tapp.errorLog(error, err);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstart: (e, ui) => {\n\t\t\t\t\tui.placeholder.height(ui.helper.outerHeight());\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t/**\n\t\t * Registers mobile devices.\n\t\t */\n\t\tregisterMobileDevices: function () {\n\t\t\tif (app.isTouchDevice()) {\n\t\t\t\tthis.container.find('.js-kanban-record').each(function () {\n\t\t\t\t\tlet element = $(this);\n\t\t\t\t\telement.find('.js-popover-tooltip--record').removeClass('js-popover-tooltip--record');\n\t\t\t\t\tlet btns = element.find('.btns');\n\t\t\t\t\tlet btnQuickEditModal = btns.find('.js-quick-edit-modal');\n\t\t\t\t\telement.addClass('js-quick-edit-modal');\n\t\t\t\t\telement.attr('href', btnQuickEditModal.attr('href'));\n\t\t\t\t\telement.attr('data-record', btnQuickEditModal.data('record'));\n\t\t\t\t\telement.attr('data-module', btnQuickEditModal.data('module'));\n\t\t\t\t\tbtns.remove();\n\t\t\t\t\telement.find('a').on('click', function (e) {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Registers Kanban view events.\n\t\t */\n\t\tregisterEvents: function () {\n\t\t\tthis.page = $('#centerPanel');\n\t\t\tthis.container = $('.js-kanban-container');\n\t\t\tthis.registerSortable();\n\t\t\tapp.showNewScrollbarTopBottom(this.container);\n\t\t\tthis.page.on('click', '.js-board-tab', (e) => {\n\t\t\t\tthis.page.find('.js-board-tab.active').removeClass('active');\n\t\t\t\t$(e.currentTarget).addClass('active');\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('change', '.js-params', () => {\n\t\t\t\tthis.loadKanban();\n\t\t\t});\n\t\t\tthis.page.on('click', '.js-list-reload', (e, data) => {\n\t\t\t\tthis.page.find('#orderBy').val(JSON.stringify(data.orderby)).trigger('change');\n\t\t\t});\n\t\t\tthis.registerMobileDevices();\n\t\t}\n\t}\n);\n"],"names":["$","Class","getParams","params","page","find","each","element","attr","val","extend","module","app","getModuleName","view","board","data","loadKanban","urlParams","Object","assign","orderBy","changeUrl","AppConnector","request","done","responseData","container","html","registerSortable","fail","status","errorThrown","showNotify","title","vtranslate","text","type","boards","sortable","containment","items","cancel","connectWith","placeholder","revert","tolerance","cursor","update","e","ui","sender","records","item","closest","Vtiger_Edit_Js","saveAjax","record","field","value","error","err","errorLog","start","height","helper","outerHeight","registerMobileDevices","isTouchDevice","removeClass","btns","btnQuickEditModal","addClass","remove","on","stopPropagation","registerEvents","showNewScrollbarTopBottom","currentTarget","JSON","stringify","orderby","trigger"],"mappings":"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"}