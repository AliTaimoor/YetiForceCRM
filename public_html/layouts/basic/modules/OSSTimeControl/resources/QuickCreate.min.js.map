{"version":3,"file":"QuickCreate.min.js","sources":["QuickCreate.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 5.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n/**\n *  Class representing a modal calendar.\n * @extends Vtiger_Calendar_Js\n */\nwindow.OSSTimeControl_CalendarModal_Js = class OSSTimeControl_CalendarModal_Js extends Vtiger_Calendar_Js {\n\tconstructor(container, readonly) {\n\t\tsuper(container, readonly);\n\t\tthis.isSwitchAllDays = false;\n\t\tthis.sidebarName = 'add'; //available: add, status, edit\n\t\tthis.eventCreate = false;\n\t\tthis.module = container.find('[name=\"module\"]').val();\n\t\tthis.renderCalendar();\n\t\tthis.registerEvents();\n\t}\n\t/**\n\t * Function sets calendar module's options\n\t * @returns {{eventClick: function, headerToolbar: object, selectable: boolean}}\n\t */\n\tsetCalendarModuleOptions() {\n\t\tlet options = super.setCalendarModuleOptions();\n\t\toptions.selectable = true;\n\t\toptions.headerToolbar = {\n\t\t\tleft: `dayGridMonth,${app.getMainParams('weekView')},${app.getMainParams('dayView')},today`,\n\t\t\tcenter: 'prevYear,prev,title,next,nextYear',\n\t\t\tright: ''\n\t\t};\n\t\toptions.eventClick = function (info) {\n\t\t\tinfo.jsEvent.preventDefault();\n\t\t};\n\t\treturn options;\n\t}\n\t/**\n\t * Function registers calendar events\n\t */\n\tregisterEvents() {\n\t\tconst calendarView = this.getCalendarView();\n\t\tthis.switchContainer = $(`<div class=\"js-calendar-switch-container\"></div>`).insertAfter(\n\t\t\tcalendarView.find('.fc-center')\n\t\t);\n\t\tthis.registerSwitchEvents();\n\t\tthis.registerUsersChange();\n\t}\n\t/**\n\t * Function registers calendar switch event\n\t */\n\tregisterSwitchEvents() {\n\t\tif (app.getMainParams('hiddenDays', true) !== false) {\n\t\t\tthis.switchContainer.html(this.createSwitch());\n\t\t\tthis.switchContainer.find('input').on('change', (e) => {\n\t\t\t\tconst currentTarget = $(e.currentTarget);\n\t\t\t\tlet hiddenDays = [];\n\t\t\t\tif (typeof currentTarget.data('on-text') !== 'undefined') {\n\t\t\t\t\thiddenDays = app.getMainParams('hiddenDays', true);\n\t\t\t\t\tthis.isSwitchAllDays = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.isSwitchAllDays = true;\n\t\t\t\t}\n\t\t\t\tthis.fullCalendar.setOption('hiddenDays', hiddenDays);\n\t\t\t\tthis.registerSwitchEvents();\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Generate filter buttons\n\t * @returns {string}\n\t */\n\tcreateSwitch() {\n\t\tlet on = app.vtranslate('JS_WORK_DAYS'),\n\t\t\toff = app.vtranslate('JS_ALL'),\n\t\t\tstate = this.isSwitchAllDays;\n\t\treturn `<div class=\"btn-group btn-group-toggle js-switch c-calendar-switch\" data-toggle=\"buttons\">\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button js-switch--label-on ${state ? '' : 'active'}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-on-text=\"${on}\" autocomplete=\"off\" ${state ? '' : 'checked'}>${on}\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"btn btn-outline-primary c-calendar-switch__button ${state ? 'active' : ''}\">\n\t\t\t\t\t\t<input type=\"radio\" name=\"options\" data-off-text=\"${off}\" autocomplete=\"off\" ${state ? 'checked' : ''}>${off}\n\t\t\t\t\t</label>\n\t\t\t\t</div>`;\n\t}\n\t/**\n\t * Function registers select's user change event\n\t */\n\tregisterUsersChange() {\n\t\tthis.container.find('.assigned_user_id').on('change', () => {\n\t\t\tthis.reloadCalendarData();\n\t\t});\n\t}\n\t/**\n\t * Get selected users\n\t * @returns {{ selectedIds: array, excludedIds: array }}\n\t */\n\tgetSelectedUsersCalendar() {\n\t\treturn { selectedIds: [this.container.find('.assigned_user_id').val()], excludedIds: [] };\n\t}\n\t/**\n\t * Function invokes by FullCalendar, sets selected days in form\n\t * @param {Object} info\n\t */\n\tselectDays(info) {\n\t\tif (this.sidebarName === 'status') {\n\t\t\tthis.sidebarName = 'add';\n\t\t\tthis.getCalendarCreateView().done(() => {\n\t\t\t\tthis.selectDays(info);\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tlet startDate = info.start,\n\t\t\tendDate = info.end;\n\t\tif (info['allDay']) {\n\t\t\tendDate.setDate(endDate.getDate() - 1);\n\t\t\tlet startDateSplitted = this.startHour.split(':');\n\t\t\tlet endDateSplitted = this.endHour.split(':');\n\t\t\tstartDate.setHours(startDateSplitted[0], startDateSplitted[1]);\n\t\t\tendDate.setHours(endDateSplitted[0], endDateSplitted[1]);\n\t\t}\n\t\tthis.container.find('[name=\"date_start\"]').val(App.Fields.Date.dateToUserFormat(startDate));\n\t\tthis.container.find('[name=\"due_date\"]').val(App.Fields.Date.dateToUserFormat(endDate));\n\t\tthis.container.find('[name=\"time_start\"]').val(App.Fields.Time.dateToUserFormat(startDate));\n\t\tthis.container.find('[name=\"time_end\"]').val(App.Fields.Time.dateToUserFormat(endDate));\n\t}\n};\n\n$.Class(\n\t'OSSTimeControl_QuickCreate_Js',\n\t{},\n\t{\n\t\tregisterEvents: function (container) {\n\t\t\tlet className = container.find('[name=\"module\"]').val() + '_CalendarModal_Js';\n\t\t\tthis.calendarView = new window[className](container.closest('.js-modal-container'), true);\n\t\t}\n\t}\n);\n"],"names":["window","OSSTimeControl_CalendarModal_Js","container","readonly","isSwitchAllDays","sidebarName","eventCreate","module","find","val","renderCalendar","registerEvents","options","selectable","headerToolbar","left","app","getMainParams","center","right","eventClick","info","jsEvent","preventDefault","calendarView","getCalendarView","switchContainer","$","insertAfter","registerSwitchEvents","registerUsersChange","html","createSwitch","on","e","currentTarget","hiddenDays","data","fullCalendar","setOption","vtranslate","off","state","reloadCalendarData","selectedIds","excludedIds","getCalendarCreateView","done","selectDays","startDate","start","endDate","end","setDate","getDate","startDateSplitted","startHour","split","endDateSplitted","endHour","setHours","App","Fields","Date","dateToUserFormat","Time","Vtiger_Calendar_Js","Class","className","closest"],"mappings":"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"}